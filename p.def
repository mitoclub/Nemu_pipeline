Bootstrap: docker
From: centos:7

%help
    This container provides portable & reproducible components for MutSpec.
    The container made by K.V. Gunbin aka GenKVG

%post
    yum --assumeyes update
    yum install --assumeyes wget git which  # python3 python3-pip python3-venv 
    # yum install --assumeyes openjdk-11-jre-headless wget ncbi-blast perl-App-cpanminus openssl-devel perl-LWP-Protocol-https ant git libxml2 zlib-devel gcc automake autoconf python3 python3-pip python3-venv
    # cpanm LWP::Simple
    # cpanm LWP::UserAgent
    # cpanm --force LWP::Protocol::https
    # cpanm File::Temp
    # cpanm Cwd

    # echo 'Installing Pipeline scripts v.2.2! '
    # cd /opt
    # wget http://bioinfodbs.kantiana.ru/pipeline-2.2.tar.gz
    # tar -xvzf pipeline-2.2.tar.gz
    # #final scripts in /opt/scripts

    yum -y groupinstall "Development Tools"
    yum -y install openssl-devel bzip2-devel libffi-devel

    PYTHON_VERSION=3.8.12
    echo 'Installing Python!'
    cd /opt
    wget https://www.python.org/ftp/python/$PYTHON_VERSION/Python-$PYTHON_VERSION.tgz
    tar -xvf Python-3.8.12.tgz
    cd Python-3.8*/

    ./configure --enable-optimizations
    make altinstall
    ln -s /usr/local/bin/python3.8 /usr/local/bin/python3

    TREESHRINK_VERSION=1.3.9
    echo 'Installing TreeShrink!'
    cd /opt
    wget https://github.com/uym2/TreeShrink/archive/refs/tags/v$TREESHRINK_VERSION.tar.gz -O TreeShrink-$TREESHRINK_VERSION.tar.gz
    tar -xvzf TreeShrink-$TREESHRINK_VERSION.tar.gz
    cd TreeShrink-$TREESHRINK_VERSION
    python3 setup.py install
    
    echo 'Installing mutspec-utils!'
    cd /opt
    git clone https://github.com/mitoclub/mutspec-utils.git
    cd mutspec-utils
    python3 setup.py install


%environment
    export LC_ALL=C
    export PATH=$PATH:/opt/scripts
    export PATH=$PATH:/opt

    export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib/

# %test
#     test_command () {
#     if ! command -v "${1}"; then
#         echo "!!!command ${1} not found!!!"
#         export FAILED_TESTS=1
#     fi
#     }

#     test_command python3
    
#     if [ -n "$FAILED_TESTS" ]; then
#         exit 1
#     fi
